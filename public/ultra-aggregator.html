
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ª—å—Ç—Ä–∞ –í–∏–¥–µ–æ –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä + –°—Ç—Ä–∏–º–∏–Ω–≥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #050714; color: #fff; min-height: 100vh; overflow-x: hidden; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 10% 20%, rgba(91, 121, 236, 0.2), transparent 40%), radial-gradient(circle at 90% 80%, rgba(255, 87, 108, 0.2), transparent 40%); pointer-events: none; z-index: 0; }
        .container { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 0; }
        h1 { font-size: 3em; margin-bottom: 10px; background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        
        .input-section { background: rgba(255,255,255,0.05); padding: 25px; border-radius: 20px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(15px); }
        .input-group { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 15px; border: none; border-radius: 12px; background: rgba(255,255,255,0.9); color: #000; font-size: 16px; outline: none; }
        .btn-add { padding: 0 30px; border: none; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; font-weight: bold; cursor: pointer; transition: 0.3s; }

        .video-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .video-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; overflow: hidden; cursor: pointer; transition: 0.4s; position: relative; }
        .video-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.08); }
        .video-thumbnail { width: 100%; aspect-ratio: 16/9; background: #121421; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 2.5em; }
        .platform-tag { font-size: 12px; margin-top: 8px; font-weight: bold; opacity: 0.5; text-transform: uppercase; }
        
        .delete-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,0,0,0.3); color: #fff; border: none; width: 30px; height: 30px; border-radius: 50%; z-index: 5; cursor: pointer; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { width: 100%; max-width: 1200px; aspect-ratio: 16/9; position: relative; }
        
        .player-viewport { position: relative; width: 100%; height: 100%; overflow: hidden; background: #000; border-radius: 8px; }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–†–û–ü: —Å–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä—ã –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º */
        iframe { 
            position: absolute; 
            border: none; 
            visibility: hidden;
            /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∏ —Å–¥–≤–∏–≥–∞–µ–º, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
            top: -15%; 
            left: -2%; 
            width: 104%; 
            height: 130%; 
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —É—Å–∏–ª–µ–Ω–Ω—ã–π –∫—Ä–æ–ø –¥–ª—è YouTube/Rutube */
        .crop-ultra iframe {
            top: -18%; 
            left: -5%; 
            width: 110%; 
            height: 140%;
        }

        iframe.visible { visibility: visible; }

        .close-modal { position: absolute; top: -50px; right: 0; background: none; border: none; color: #fff; font-size: 3em; cursor: pointer; }

        .ad-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        .ad-layer.active { display: flex; }
        .ad-video { width: 100%; height: 100%; object-fit: contain; }
        .ad-status { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .ad-btns { position: absolute; bottom: 30px; right: 30px; display: flex; gap: 15px; pointer-events: auto; }
        .ad-btn { background: #fff; color: #000; padding: 12px 24px; border-radius: 5px; font-weight: 800; cursor: pointer; border: none; }
        .skip-btn { display: none; background: #333; color: #fff; }
        .skip-btn.show { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–£–ª—å—Ç—Ä–∞ –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä</h1>
            <p style="opacity:0.5;">Twitch ‚Ä¢ Kick ‚Ä¢ VK Live ‚Ä¢ YouTube ‚Ä¢ Rutube ‚Ä¢ Direct Links</p>
			FAQ - –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É StreamLiveTV –∏–ª–∏ –¥—Ä—É–≥—É—é –ª—é–±—É—é –Ω—É–∂–Ω–æ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å ?watch=–î–æ–º–µ–Ω —Å–µ—Ä–≤–∏—Å–∞ –≤–∏–¥–µ–æ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –≤–∏–¥–µ–æ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –Ω–∞ —Å–∞–π—Ç
        </header>

        <div class="input-section">
            <div class="input-group">
                <input type="text" id="videoUrl" placeholder="–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ –∏–ª–∏ —Å—Ç—Ä–∏–º..." />
                <button class="btn-add" onclick="addVideo()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>

        <div class="video-list" id="videoList"></div>
    </div>

    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="player-viewport" id="viewport">
                <div class="ad-layer" id="adLayer">
                    <video class="ad-video" id="adVid" playsinline></video>
                    <div class="ad-status" id="adCounter">–†–µ–∫–ª–∞–º–∞</div>
                    <div class="ad-btns">
                        <button class="ad-btn" id="unmuteAd" onclick="unmuteAd()">üîä –ó–≤—É–∫</button>
                        <button class="ad-btn skip-btn" id="skipAd" onclick="skipAd()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚ñ∂</button>
                    </div>
                </div>
                <iframe id="vPlayer" allow="autoplay; fullscreen; picture-in-picture"></iframe>
            </div>
        </div>
    </div>

    <script>
        // –°–ü–ò–°–û–ö –†–ï–ö–õ–ê–ú–´ (10 —Å–ª–æ—Ç–æ–≤)
        const AD_URLS = [
            'https://fkveoqzztgwdeayaqixv.supabase.co/storage/v1/object/public/videos/aa75a652-5aaa-4673-a7ca-e693a76eba89/1764128171130.mp4',
            'https://fkveoqzztgwdeayaqixv.supabase.co/storage/v1/object/public/videos/aa75a652-5aaa-4673-a7ca-e693a76eba89/1764128171130.mp4',
            'https://fkveoqzztgwdeayaqixv.supabase.co/storage/v1/object/public/videos/aa75a652-5aaa-4673-a7ca-e693a76eba89/1764128171130.mp4',
            'https://www.dropbox.com/scl/fi/x4m5zyuljblncremkn935/.mp4?rlkey=d7onlggzeenjrbedx9svq8532&st=sx4467mr&dl=1',
            'https://www.dropbox.com/scl/fi/x4m5zyuljblncremkn935/.mp4?rlkey=d7onlggzeenjrbedx9svq8532&st=sx4467mr&dl=1',
            'https://www.dropbox.com/scl/fi/x4m5zyuljblncremkn935/.mp4?rlkey=d7onlggzeenjrbedx9svq8532&st=sx4467mr&dl=1',
            'https://www.dropbox.com/scl/fi/to5eki6hexfq8cfik3fyc/b40f38171014492bb9eb619319edfca0.mp4?rlkey=pky0rhlnh48wx1m3ex2qvwp0v&st=ygr0bdq5&dl=1',
            'https://www.dropbox.com/scl/fi/to5eki6hexfq8cfik3fyc/b40f38171014492bb9eb619319edfca0.mp4?rlkey=pky0rhlnh48wx1m3ex2qvwp0v&st=ygr0bdq5&dl=1',
            'https://www.dropbox.com/scl/fi/x4m5zyuljblncremkn935/.mp4?rlkey=d7onlggzeenjrbedx9svq8532&st=sx4467mr&dl=1',
            'https://www.dropbox.com/scl/fi/x4m5zyuljblncremkn935/.mp4?rlkey=d7onlggzeenjrbedx9svq8532&st=sx4467mr&dl=1'
        ];

        let savedVideos = [];
        let adQueue = 0;
        let totalAdsRequested = 0;
        let midRoll = null;

        function init() {
            const data = localStorage.getItem('ultra_agg_v5');
            if (data) { savedVideos = JSON.parse(data); render(); }
            
            const urlParam = new URLSearchParams(window.location.search).get('watch');
            if (urlParam) {
                const newVid = parseLink(urlParam);
                if (newVid) {
                    savedVideos.unshift(newVid);
                    save(); render();
                    startPlayback(newVid.id);
                }
            }
        }

        function save() { localStorage.setItem('ultra_agg_v5', JSON.stringify(savedVideos)); }

        function parseLink(url) {
            let p = 'link', embed = '', crop = 'standard';
            if (url.includes('twitch.tv')) {
                p = 'twitch';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://player.twitch.tv/?channel=${id}&parent=oinktech.blyz.ru&autoplay=true`;
            } 
            else if (url.includes('kick.com')) {
                p = 'kick';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://player.kick.com/${id}&parent=oinktech.blyz.ru`;
            }
			else if (url.includes('w.tv')) {
                p = 'wtv';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://w.tv/${id}&parent=oinktech.blyz.ru`;
            }
		    else if (url.includes('matreshka.tv')) {
                p = 'mattv';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://matreshka.tv/en/embed/${id}?autoplay=1&mute=0&parent=oinktech.blyz.ru`;
            }
		   else if (url.includes('plvideo.ru')) {
                p = 'plvideo';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://plvideo.ru/embed/${id}&parent=oinktech.blyz.ru`;
            }
		    else if (url.includes('catcast.tv')) {
                p = 'ctv';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://catcast.tv/${id}&parent=oinktech.blyz.ru`;
            }
			   else if (url.includes('dzen.ru')) {
                p = 'dzenvk';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://dzen.ru/embed/${id}?autoplay=1&mute=0&parent=oinktech.blyz.ru`;
            }
					   else if (url.includes('vimeo.com')) {
                p = 'Vimeo';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://player.vimeo.com/video/${id}?autoplay=1&mute=0&parent=oinktech.blyz.ru`;
            }
			else if (url.includes('www.dailymotion.com')) {
                p = 'dailymotion';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://www.dailymotion.com/embed/video/${id}?autoplay=1&mute=0&parent=oinktech.blyz.ru`;
            }
			else if (url.includes('livestudio-creator.lovable.app')) {
                p = 'StreamLiveTV';
                let id = url.split('/').pop().split('?')[0];
                embed = `https://livestudio-creator.lovable.app/embed/${id}?autoplay=1&mute=0&parent=oinktech.blyz.ru`;
            }
			else if (url.includes('live.vkvideo.ru')) {
            p = 'vktv';
            let id = url.split('/').pop().split('?')[0];
            embed = `https://live.vkvideo.ru/embed/${id}&parent=oinktech.blyz.ru`;
            }
            else if (url.includes('vkvideo.ru') || url.includes('vk.com') || url.includes('vk.ru')) {
                p = 'vk_video';
                let m = url.match(/video(-?\d+_\d+)/);
                if (m) embed = `https://vk.com/video_ext.php?oid=${m[1].split('_')[0]}&id=${m[1].split('_')[1]}&autoplay=1&parent=oinktech.blyz.ru`;
            }
            else if (url.includes('youtube.com') || url.includes('youtu.be')) {
                p = 'youtube'; crop = 'ultra';
                let id = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/)?.[1];
                embed = `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&controls=0&modestbranding=1&rel=0&parent=oinktech.blyz.ru`;
            }
            else if (url.includes('rutube.ru')) {
                p = 'rutube'; crop = 'ultra';
                let id = url.match(/\/video\/([a-f0-9]+)/)?.[1];
                embed = `https://rutube.ru/play/embed/${id}?autoplay=1&mute=0&skinColor=00000000&parent=oinktech.blyz.ru`;
            }
            else { p = 'generic'; embed = url; }
            return embed ? { id: Date.now(), platform: p, url: embed, crop: crop } : null;
        }

        function addVideo() {
            const val = document.getElementById('videoUrl').value.trim();
            const vid = parseLink(val);
            if (!vid) return alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—Å—ã–ª–∫—É');
            savedVideos.unshift(vid); save(); render();
            document.getElementById('videoUrl').value = '';
        }

        function render() {
            const list = document.getElementById('videoList');
            const icons = { twitch:'üéÆ', kick:'üü¢', vk_video:'üé•', youtube:'üìπ', rutube:'üì∫', generic:'üîó' };
            list.innerHTML = savedVideos.map(v => `
                <div class="video-card" onclick="startPlayback(${v.id})">
                    <button class="delete-btn" onclick="event.stopPropagation();del(${v.id})">‚úï</button>
                    <div class="video-thumbnail">
                        ${icons[v.platform] || 'üéûÔ∏è'}
                        <div class="platform-tag">${v.platform}</div>
                    </div>
                </div>
            `).join('');
        }

        function del(id) { savedVideos = savedVideos.filter(v => v.id !== id); save(); render(); }

        function startPlayback(id) {
            const v = savedVideos.find(x => x.id === id);
            const modal = document.getElementById('videoModal');
            const iframe = document.getElementById('vPlayer');
            const view = document.getElementById('viewport');

            modal.classList.add('active');
            iframe.classList.remove('visible');
            iframe.src = v.url;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫—Ä–æ–ø
            view.className = 'player-viewport';
            if (v.crop === 'ultra') view.classList.add('crop-ultra');

            launchAds(5); 

            if (midRoll) clearInterval(midRoll);
            midRoll = setInterval(() => launchAds(5), 900000); 
        }

        function launchAds(count) {
            adQueue = count;
            totalAdsRequested = count;
            playAdStep();
        }

        function playAdStep() {
            const layer = document.getElementById('adLayer');
            const vid = document.getElementById('adVid');
            const iframe = document.getElementById('vPlayer');
            const skip = document.getElementById('skipAd');
            const counter = document.getElementById('adCounter');

            if (adQueue <= 0) {
                layer.classList.remove('active');
                vid.src = '';
                iframe.classList.add('visible');
                return;
            }

            iframe.classList.remove('visible');
            layer.classList.add('active');
            skip.classList.remove('show');
            counter.textContent = `–†–µ–∫–ª–∞–º–∞: ${totalAdsRequested - adQueue + 1} –∏–∑ ${totalAdsRequested}`;

            vid.src = AD_URLS[Math.floor(Math.random() * AD_URLS.length)];
            vid.muted = false;
            vid.play().catch(() => {
                vid.muted = true;
                vid.play();
                document.getElementById('unmuteAd').style.display = 'block';
            });

            setTimeout(() => skip.classList.add('show'), 5000);
            vid.onended = () => { adQueue--; playAdStep(); };
        }

        function skipAd() { adQueue--; playAdStep(); }

        function unmuteAd() {
            document.getElementById('adVid').muted = false;
            document.getElementById('unmuteAd').style.display = 'none';
        }

        function closeModal() {
            document.getElementById('videoModal').classList.remove('active');
            document.getElementById('vPlayer').src = '';
            document.getElementById('adVid').src = '';
            adQueue = 0;
            if (midRoll) clearInterval(midRoll);
        }

        window.onload = init;
    </script>
</body>
</html>